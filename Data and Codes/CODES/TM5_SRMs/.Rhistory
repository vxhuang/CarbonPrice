library(ggmap)
library(maps)
library(viridis)
library(dplyr)
library(tidyr)
library(wbstats)
source("~/Documents/PSU/2020 Spring/Research/GCAM emissions matching/TM5_FASST.R")
source("~/Documents/PSU/2020 Spring/Research/GCAM emissions matching/downscaling.R")
setwd("~/Documents/PSU/2020 Spring/Research/GCAM emissions matching/")
RUE_ratio <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/COUNTRY-FASST-TABLE_GENERATOR_v2.xlsx", sheet = 3, range = "B1:I2")
987+138
# GCAM
gcam_2010 <- read_xlsx("~/Documents/PSU/2020 Spring/Research/GCAM emissions matching/SampleData_v5.2.xlsx", sheet = 1, skip = 1) %>% select(c("region", "GHG", "2010"))
USA <- c(state.abb, "DC", "Alaska grid", "California grid", "Central East grid",
"Central Northeast grid", "Central Northwest grid", "Central Southwest grid",
"Florida grid", "Hawaii grid", "Mid-Atlantic grid", "New England grid",
"New York grid", "Northwest grid", "Southeast grid", "Southwest grid",
"Texas grid", "USA")
gcam_2010 <- gcam_2010 %>% mutate(region = ifelse(region %in% USA, "USA", region))
BC <- c("BC", "BC_AWB")
CH4 <- c("CH4", "CH4_AGR", "CH4_AWB")
CO <- c("CO", "CO_AWB")
NH3 <- c("NH3", "NH3_AGR", "NH3_AWB")
NMVOC <- c("NMVOC", "NMVOC_AWB")
NOx <- c("NOx", "NOx_AGR", "NOx_AWB")
OC <- c("OC", "OC_AWB")
SO2 <- c("SO2", "SO2_1","SO2_1_AWB", "SO2_2","SO2_2_AWB", "SO2_3","SO2_3_AWB", "SO2_4","SO2_4_AWB")
world.pop <- wb(indicator = "SP.POP.TOTL", startdate = 2010, enddate = 2010) %>% select(iso3c, value) %>%
rename("ISO_A3" = "iso3c", "pop" = "value")
RUE_ratio <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/COUNTRY-FASST-TABLE_GENERATOR_v2.xlsx", sheet = 3, range = "B1:I2")
FASST_mapping <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/COUNTRY-FASST-TABLE_GENERATOR_v2.xlsx", sheet = 1, range = "A1:C231")
FASST_mapping <- FASST_mapping %>% rename("ISO_A3" = "ISO 3")
View(FASST_mapping)
FASST_mapping <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/COUNTRY-FASST-TABLE_GENERATOR_v2.xlsx", sheet = 1, range = "A1:C231")
FASST_mapping <- FASST_mapping %>% rename("ISO_A3" = "ISO 3")
View(FASST_mapping)
# GCAM
gcam_2010 <- read_xlsx("~/Documents/PSU/2020 Spring/Research/GCAM emissions matching/SampleData_v5.2.xlsx", sheet = 1, skip = 1) %>% select(c("region", "GHG", "2010"))
USA <- c(state.abb, "DC", "Alaska grid", "California grid", "Central East grid",
"Central Northeast grid", "Central Northwest grid", "Central Southwest grid",
"Florida grid", "Hawaii grid", "Mid-Atlantic grid", "New England grid",
"New York grid", "Northwest grid", "Southeast grid", "Southwest grid",
"Texas grid", "USA")
gcam_2010 <- gcam_2010 %>% mutate(region = ifelse(region %in% USA, "USA", region))
BC <- c("BC", "BC_AWB")
CH4 <- c("CH4", "CH4_AGR", "CH4_AWB")
CO <- c("CO", "CO_AWB")
NH3 <- c("NH3", "NH3_AGR", "NH3_AWB")
NMVOC <- c("NMVOC", "NMVOC_AWB")
NOx <- c("NOx", "NOx_AGR", "NOx_AWB")
OC <- c("OC", "OC_AWB")
SO2 <- c("SO2", "SO2_1","SO2_1_AWB", "SO2_2","SO2_2_AWB", "SO2_3","SO2_3_AWB", "SO2_4","SO2_4_AWB")
world.pop <- wb(indicator = "SP.POP.TOTL", startdate = 2010, enddate = 2010) %>% select(iso3c, value) %>%
rename("ISO_A3" = "iso3c", "pop" = "value")
world.pop <- rbind(world.pop, c("TWN", 1))
world.pop$pop <- as.numeric(world.pop$pop)
gcam_2010 <- gcam_2010 %>% filter(GHG %in% c(BC, CH4, CO, NH3, NMVOC, NOx, OC, SO2, "PM2.5"))
gcam_2010 <- gcam_2010 %>% mutate(GHG = ifelse(GHG %in% BC, "BC", GHG)) %>% mutate(GHG = ifelse(GHG %in% CH4, "CH4", GHG)) %>%
mutate(GHG = ifelse(GHG %in% CO, "CO", GHG)) %>% mutate(GHG = ifelse(GHG %in% NH3, "NH3", GHG)) %>%
mutate(GHG = ifelse(GHG %in% NMVOC, "NMVOC", GHG)) %>% mutate(GHG = ifelse(GHG %in% NOx, "NOx", GHG)) %>%
mutate(GHG = ifelse(GHG %in% OC, "OC", GHG)) %>% mutate(GHG = ifelse(GHG %in% SO2, "SO2", GHG))
gcam_2010 <- gcam_2010 %>% group_by(region, GHG) %>% summarise(`2010` = sum(`2010`)) %>% ungroup()
View(gcam_2010)
# GCAM
gcam_2010 <- read_xlsx("~/Documents/PSU/2020 Spring/Research/GCAM emissions matching/SampleData_v5.2.xlsx", sheet = 1, skip = 1) %>% select(c("region", "GHG", "2010"))
USA <- c(state.abb, "DC", "Alaska grid", "California grid", "Central East grid",
"Central Northeast grid", "Central Northwest grid", "Central Southwest grid",
"Florida grid", "Hawaii grid", "Mid-Atlantic grid", "New England grid",
"New York grid", "Northwest grid", "Southeast grid", "Southwest grid",
"Texas grid", "USA")
gcam_2010 <- gcam_2010 %>% mutate(region = ifelse(region %in% USA, "USA", region))
BC <- c("BC", "BC_AWB")
CH4 <- c("CH4", "CH4_AGR", "CH4_AWB")
# CO <- c("CO", "CO_AWB")
NH3 <- c("NH3", "NH3_AGR", "NH3_AWB")
NMVOC <- c("NMVOC", "NMVOC_AWB")
NOx <- c("NOx", "NOx_AGR", "NOx_AWB")
OC <- c("OC", "OC_AWB")
SO2 <- c("SO2", "SO2_1","SO2_1_AWB", "SO2_2","SO2_2_AWB", "SO2_3","SO2_3_AWB", "SO2_4","SO2_4_AWB")
world.pop <- wb(indicator = "SP.POP.TOTL", startdate = 2010, enddate = 2010) %>% select(iso3c, value) %>%
rename("ISO_A3" = "iso3c", "pop" = "value")
world.pop <- rbind(world.pop, c("TWN", 1))
world.pop$pop <- as.numeric(world.pop$pop)
gcam_2010 <- gcam_2010 %>% filter(GHG %in% c(BC, CH4, NH3, NMVOC, NOx, OC, SO2, "PM2.5"))
gcam_2010 <- gcam_2010 %>% mutate(GHG = ifelse(GHG %in% BC, "BC", GHG)) %>% mutate(GHG = ifelse(GHG %in% CH4, "CH4", GHG)) %>%
# mutate(GHG = ifelse(GHG %in% CO, "CO", GHG)) %>%
mutate(GHG = ifelse(GHG %in% NH3, "NH3", GHG)) %>%
mutate(GHG = ifelse(GHG %in% NMVOC, "NMVOC", GHG)) %>% mutate(GHG = ifelse(GHG %in% NOx, "NOx", GHG)) %>%
mutate(GHG = ifelse(GHG %in% OC, "OC", GHG)) %>% mutate(GHG = ifelse(GHG %in% SO2, "SO2", GHG))
gcam_2010 <- gcam_2010 %>% group_by(region, GHG) %>% summarise(`2010` = sum(`2010`)) %>% ungroup()
gcam_2010 <- gcam_2010 %>% spread(GHG, `2010`)
gcam_2010[, -1] = gcam_2010[, -1] * 1000
gcam_2010 <- gcam_2010 %>% mutate(OC = OC * 1.3) %>% rename("POM" = "OC")
View(gcam_2010)
# comparison with GCAM and EDGAR
BC_EDGAR_2010 <- read_xls("v432_BC_1970_2012.xls", sheet = 1, skip = 7) %>%
select(c(`ISO_A3`, `IPCC_description`, `2010`))
NH3_EDGAR_2010 <- read_xls("v432_BC_1970_2012.xls", sheet = 1, skip = 7) %>%
select(c(`ISO_A3`, `IPCC_description`, `2010`))
CO_EDGAR_2010 <- read_xls("v432_CO_1970_2012.xls", sheet = 1, skip = 7) %>%
select(c(`ISO_A3`, `IPCC_description`, `2010`))
NH3_EDGAR_2010 <- read_xls("v432_NH3_1970_2012.xls", sheet = 1, skip = 7) %>%
select(c(`ISO_A3`, `IPCC_description`, `2010`))
NMVOC_EDGAR_2010 <- read_xls("v432_NMVOC_1970_2012.xls", sheet = 1, skip = 7) %>%
select(c(`ISO_A3`, `IPCC_description`, `2010`))
NOx_EDGAR_2010 <- read_xls("v432_NOx_1970_2012.xls", sheet = 1, skip = 7) %>%
select(c(`ISO_A3`, `IPCC_description`, `2010`))
OC_EDGAR_2010 <- read_xls("v432_OC_1970_2012.xls", sheet = 1, skip = 7) %>%
select(c(`ISO_A3`, `IPCC_description`, `2010`))
SO2_EDGAR_2010 <- read_xls("v432_SO2_1970_2012.xls", sheet = 1, skip = 7) %>%
select(c(`ISO_A3`, `IPCC_description`, `2010`))
PM2.5bio_EDGAR_2010 <- read_xls("v432_PM2.5_bio_1970_2012.xls", sheet = 1, skip = 7) %>%
select(c(`ISO_A3`, `IPCC_description`, `2010`))
PM2.5fossil_EDGAR_2010 <- read_xls("v432_PM2.5_fossil_1970_2012.xls", sheet = 1, skip = 7) %>%
select(c(`ISO_A3`, `IPCC_description`, `2010`))
PM2.5_EDGAR_2010 <- rbind(PM2.5bio_EDGAR_2010, PM2.5fossil_EDGAR_2010)
CH4_EDGAR_2010 <- read_xls("v50_CH4_1970_2015.xls", sheet = 1, skip = 9) %>%
select(c(`ISO_A3`, `IPCC_description`, `2010`))
CH4_EDGAR_2010 <- CH4_EDGAR_2010 %>% filter(!grepl("NULL", `2010`))
CH4_EDGAR_2010$`2010` <- as.numeric(CH4_EDGAR_2010$`2010`)
CO2_EDGAR_2010 <- read_xls("v50_CO2_excl_short-cycle_org_C_1970_2018.xls", sheet = 1, skip = 9) %>%
select(c(`ISO_A3`, `IPCC_description`, `2010`))
BC_EDGAR_2010 <- BC_EDGAR_2010 %>% group_by(ISO_A3) %>% summarise(`2010` = sum(`2010`, na.rm = T)) %>%
left_join(region_mapping[, c(1, 3)], by = c("ISO_A3" = "ISO_A3")) %>% ungroup() %>% left_join(world.pop, by = "ISO_A3") %>% drop_na()
BC_EDGAR_2010 <- BC_EDGAR_2010 %>% group_by(`GCAM`) %>% summarise(`2010` = sum(`2010`))
CO_EDGAR_2010 <- CO_EDGAR_2010 %>% group_by(ISO_A3) %>% summarise(`2010` = sum(`2010`, na.rm = T)) %>%
left_join(region_mapping[, c(1, 3)], by = c("ISO_A3" = "ISO_A3")) %>% ungroup() %>% left_join(world.pop, by = "ISO_A3") %>% drop_na()
CO_EDGAR_2010<- CO_EDGAR_2010 %>% group_by(`GCAM`) %>% summarise(`2010` = sum(`2010`))
NH3_EDGAR_2010 <- NH3_EDGAR_2010 %>% group_by(ISO_A3) %>% summarise(`2010` = sum(`2010`, na.rm = T)) %>%
left_join(region_mapping[, c(1, 3)], by = c("ISO_A3" = "ISO_A3")) %>% ungroup() %>% left_join(world.pop, by = "ISO_A3") %>% drop_na()
NH3_EDGAR_2010<- NH3_EDGAR_2010 %>% group_by(`GCAM`) %>% summarise(`2010` = sum(`2010`))
NMVOC_EDGAR_2010 <- NMVOC_EDGAR_2010 %>% group_by(ISO_A3) %>% summarise(`2010` = sum(`2010`, na.rm = T)) %>%
left_join(region_mapping[, c(1, 3)], by = c("ISO_A3" = "ISO_A3")) %>% ungroup() %>% left_join(world.pop, by = "ISO_A3") %>% drop_na()
NMVOC_EDGAR_2010<- NMVOC_EDGAR_2010 %>% group_by(`GCAM`) %>% summarise(`2010` = sum(`2010`))
NOx_EDGAR_2010 <- NOx_EDGAR_2010 %>% group_by(ISO_A3) %>% summarise(`2010` = sum(`2010`, na.rm = T)) %>%
left_join(region_mapping[, c(1, 3)], by = c("ISO_A3" = "ISO_A3")) %>% ungroup() %>% left_join(world.pop, by = "ISO_A3") %>% drop_na()
NOx_EDGAR_2010<- NOx_EDGAR_2010 %>% group_by(`GCAM`) %>% summarise(`2010` = sum(`2010`))
OC_EDGAR_2010 <- OC_EDGAR_2010 %>% group_by(ISO_A3) %>% summarise(`2010` = sum(`2010`, na.rm = T)) %>%
left_join(region_mapping[, c(1, 3)], by = c("ISO_A3" = "ISO_A3")) %>% ungroup() %>% left_join(world.pop, by = "ISO_A3") %>% drop_na()
OC_EDGAR_2010<- OC_EDGAR_2010 %>% group_by(`GCAM`) %>% summarise(`2010` = sum(`2010`))
SO2_EDGAR_2010 <- SO2_EDGAR_2010 %>% group_by(ISO_A3) %>% summarise(`2010` = sum(`2010`, na.rm = T)) %>%
left_join(region_mapping[, c(1, 3)], by = c("ISO_A3" = "ISO_A3")) %>% ungroup() %>% left_join(world.pop, by = "ISO_A3") %>% drop_na()
SO2_EDGAR_2010<- SO2_EDGAR_2010 %>% group_by(`GCAM`) %>% summarise(`2010` = sum(`2010`))
CH4_EDGAR_2010 <- CH4_EDGAR_2010 %>% group_by(ISO_A3) %>% summarise(`2010` = sum(`2010`, na.rm = T)) %>%
left_join(region_mapping[, c(1, 3)], by = c("ISO_A3" = "ISO_A3")) %>% ungroup() %>% left_join(world.pop, by = "ISO_A3") %>% drop_na()
CH4_EDGAR_2010<- CH4_EDGAR_2010 %>% group_by(`GCAM`) %>% summarise(`2010` = sum(`2010`))
PM2.5_EDGAR_2010 <- PM2.5_EDGAR_2010 %>% group_by(ISO_A3) %>% summarise(`2010` = sum(`2010`, na.rm = T)) %>%
left_join(region_mapping[, c(1, 3)], by = c("ISO_A3" = "ISO_A3")) %>% ungroup() %>% left_join(world.pop, by = "ISO_A3") %>% drop_na()
PM2.5_EDGAR_2010<- PM2.5_EDGAR_2010 %>% group_by(`GCAM`) %>% summarise(`2010` = sum(`2010`))
EDGAR_2010_ALL <- BC_EDGAR_2010 %>% rename("BC" = `2010`) %>%
left_join(CH4_EDGAR_2010, by = c("GCAM")) %>% rename("CH4" = `2010`) %>%
left_join(NH3_EDGAR_2010, by = c("GCAM")) %>% rename("NH3" = `2010`) %>%
left_join(NOx_EDGAR_2010, by = c("GCAM")) %>% rename("NOx" = `2010`) %>%
left_join(OC_EDGAR_2010, by = c("GCAM")) %>% rename("OC" = `2010`) %>%
left_join(SO2_EDGAR_2010, by = c("GCAM")) %>% rename("SO2" = `2010`) %>%
left_join(NMVOC_EDGAR_2010, by = c("GCAM")) %>% rename("NMVOC" = `2010`) %>%
left_join(PM2.5_EDGAR_2010, by = c("GCAM")) %>% rename("PM2.5" = `2010`)
EDGAR_2010_ALL <- EDGAR_2010_ALL %>% mutate(OC = OC * 1.3) %>% rename("POM" = "OC")
View(EDGAR_2010_ALL)
View(EDGAR_2010_ALL)
EDGAR_2010_ALL_tmp <- EDGAR_2010_ALL[, c(1,2,3,4,8,5,6,7)] %>% tibble::column_to_rownames("GCAM")
View(EDGAR_2010_ALL_tmp)
diff2 <- (gcam_2010[, -c(1,4)] - EDGAR_2010_ALL_tmp)/(EDGAR_2010_ALL_tmp)
rownames(diff2) <- rownames(EDGAR_2010_ALL_tmp)
diff2 <- (gcam_2010[, -1] - EDGAR_2010_ALL_tmp)/(EDGAR_2010_ALL_tmp)
rownames(diff2) <- rownames(EDGAR_2010_ALL_tmp)
View(diff2)
1044/-630
1044-630
414/27
42/2590
View(FASST_mapping)
setwd("~/Documents/PSU/2020 Spring/Research/TM5_SRMs/")
library(readxl)
library(dplyr)
diag_only <- function(SRM) {
for(i in 1 : nrow(SRM)) {
for(j in 1 : ncol(SRM)) {if (i != j) SRM[i, j] <- 0}
}
return(SRM)
}
AR5_EM <-read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 7) %>% tibble::column_to_rownames("SOURCE REGION")
AR5_CONC <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 8) %>% tibble::column_to_rownames("RECEPTOR REGION")
CH4_TO_SDMA8_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 9) %>% tibble::column_to_rownames("COUNTRY")
View(CH4_TO_SDMA8_POPW_perkT_local)
receptor_only <- function(SRM, receptor) {
for(j in 1 : ncol(SRM)) {
if(colnames(SRM)[j] != receptor) SRM[j] <- 0
}
return(SRM)
}
AR5_EM <-read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 7) %>% tibble::column_to_rownames("SOURCE REGION")
AR5_CONC <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 8) %>% tibble::column_to_rownames("RECEPTOR REGION")
CH4_TO_SDMA8_POPW_perkT_local %>% receptor_only("NDE")
receptor <- "NDE"
receptor_only <- function(SRM, receptor) {
for(j in 1 : ncol(SRM)) {
if(colnames(SRM)[j] != receptor) SRM[j] <- 0
}
return(SRM)
}
AR5_EM <-read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 7) %>% tibble::column_to_rownames("SOURCE REGION")
AR5_CONC <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 8) %>% tibble::column_to_rownames("RECEPTOR REGION")
CH4_TO_SDMA8_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 9) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
NOx_TO_SDMA8_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 10) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
NMVOC_TO_SDMA8_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 11) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
SO2_TO_SDMA8_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 12) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
NH3_TO_NO3_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 13) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
NH3_TO_NH4_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 14) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
NH3_TO_SO4_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 15) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
NOx_TO_NH4_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 16) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
NOx_TO_NO3_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 17) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
NOx_TO_SO4_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 18) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
SO2_TO_SO4_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 19) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
SO2_TO_NH4_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 20) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
SO2_TO_NO3_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 21) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
PRPM25_TO_PRPM25_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 22) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
BC_TO_BC_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 23) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
POM_TO_POM_POPW_perkT_local <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 24) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
# This is a tentative input - it should be changed to output from GCAM
input <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 4) %>% tibble::column_to_rownames("kTonne/year")
colnames(input) <- toupper(colnames(input))
# Calculate delta for each emission
delta_EM_AR5 <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 5) %>% tibble::column_to_rownames("SOURCE REGION")
delta_EM_AR5 <- input[match(rownames(delta_EM_AR5), rownames(input)), ] - AR5_EM[match(rownames(delta_EM_AR5), rownames(AR5_EM)), ]
View(delta_EM_AR5)
# This is a tentative input - it should be changed to output from GCAM
input <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 4) %>% tibble::column_to_rownames("kTonne/year")
colnames(input) <- toupper(colnames(input))
# Calculate delta for each emission
delta_EM_AR5 <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 5) %>% tibble::column_to_rownames("SOURCE REGION")
delta_EM_AR5 <- input[match(rownames(delta_EM_AR5), rownames(input)), ] - AR5_EM[match(rownames(delta_EM_AR5), rownames(AR5_EM)), ]
delta_EM_AR5$PM2.5 <- delta_EM_AR5$PM2.5 - delta_EM_AR5$BC - delta_EM_AR5$POM
AR5_EM <-read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 7) %>% tibble::column_to_rownames("SOURCE REGION")
AR5_CONC <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 8) %>% tibble::column_to_rownames("RECEPTOR REGION")
CH4_TO_SDMA8_POPW_perkT <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 9) %>% tibble::column_to_rownames("COUNTRY")
NOx_TO_SDMA8_POPW_perkT <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 10) %>% tibble::column_to_rownames("COUNTRY")
NMVOC_TO_SDMA8_POPW_perkT <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 11) %>% tibble::column_to_rownames("COUNTRY")
SO2_TO_SDMA8_POPW_perkT <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 12) %>% tibble::column_to_rownames("COUNTRY")
NH3_TO_NO3_POPW_perkT <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 13) %>% tibble::column_to_rownames("COUNTRY")
NH3_TO_NH4_POPW_perkT <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 14) %>% tibble::column_to_rownames("COUNTRY")
NH3_TO_SO4_POPW_perkT <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 15) %>% tibble::column_to_rownames("COUNTRY")
NOx_TO_NH4_POPW_perkT <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 16) %>% tibble::column_to_rownames("COUNTRY")
NOx_TO_NO3_POPW_perkT <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 17) %>% tibble::column_to_rownames("COUNTRY")
NOx_TO_SO4_POPW_perkT <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 18) %>% tibble::column_to_rownames("COUNTRY")
SO2_TO_SO4_POPW_perkT <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 19) %>% tibble::column_to_rownames("COUNTRY")
SO2_TO_NH4_POPW_perkT <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 20) %>% tibble::column_to_rownames("COUNTRY")
SO2_TO_NO3_POPW_perkT <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 21) %>% tibble::column_to_rownames("COUNTRY")
PRPM25_TO_PRPM25_POPW_perkT <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 22) %>% tibble::column_to_rownames("COUNTRY")
BC_TO_BC_POPW_perkT <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 23) %>% tibble::column_to_rownames("COUNTRY")
POM_TO_POM_POPW_perkT <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 24) %>% tibble::column_to_rownames("COUNTRY")
# Calculate delta for each emission
delta_EM_AR5 <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 5) %>% tibble::column_to_rownames("SOURCE REGION")
delta_EM_AR5 <- input[match(rownames(delta_EM_AR5), rownames(input)), ] - AR5_EM[match(rownames(delta_EM_AR5), rownames(AR5_EM)), ]
delta_EM_AR5$PM2.5 <- delta_EM_AR5$PM2.5 - delta_EM_AR5$bc - delta_EM_AR5$pom
output <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 2, skip = 3) %>% tibble::column_to_rownames("RECEPTOR")
output$`SO4(SO2)` <- apply(SO2_TO_SO4_POPW_perkT[, match(rownames(output), colnames(SO2_TO_SO4_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$so2))
# Calculate delta for each emission
delta_EM_AR5 <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 5) %>% tibble::column_to_rownames("SOURCE REGION")
delta_EM_AR5 <- input[match(rownames(delta_EM_AR5), rownames(input)), ] - AR5_EM[match(rownames(delta_EM_AR5), rownames(AR5_EM)), ]
delta_EM_AR5$PM2.5 <- delta_EM_AR5$PM2.5 - delta_EM_AR5$bc - delta_EM_AR5$pom
colnames(input) <- toupper(colnames(input))
# Calculate delta for each emission
delta_EM_AR5 <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 5) %>% tibble::column_to_rownames("SOURCE REGION")
delta_EM_AR5 <- input[match(rownames(delta_EM_AR5), rownames(input)), ] - AR5_EM[match(rownames(delta_EM_AR5), rownames(AR5_EM)), ]
delta_EM_AR5$PM2.5 <- delta_EM_AR5$PM2.5 - delta_EM_AR5$BC - delta_EM_AR5$POM
output <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 2, skip = 3) %>% tibble::column_to_rownames("RECEPTOR")
output$`SO4(SO2)` <- apply(SO2_TO_SO4_POPW_perkT[, match(rownames(output), colnames(SO2_TO_SO4_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$SO2))
output$`NO3(SO2)` <- apply(SO2_TO_NO3_POPW_perkT[, match(rownames(output), colnames(SO2_TO_NO3_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$SO2))
output$`NH4(SO2)` <- apply(SO2_TO_NH4_POPW_perkT[, match(rownames(output), colnames(SO2_TO_NH4_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$SO2))
output$`SO4(NOx)` <- apply(NOx_TO_SO4_POPW_perkT[, match(rownames(output), colnames(NOx_TO_SO4_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$NOX))
output$`NO3(NOx)` <- apply(NOx_TO_NO3_POPW_perkT[, match(rownames(output), colnames(NOx_TO_NO3_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$NOX))
output$`NH4(NOx)` <- apply(NOx_TO_NH4_POPW_perkT[, match(rownames(output), colnames(NOx_TO_NH4_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$NOX))
output$`SO4(NH3)` <- apply(NH3_TO_SO4_POPW_perkT[, match(rownames(output), colnames(NH3_TO_SO4_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$NH3))
output$`NO3(NH3)` <- apply(NH3_TO_NO3_POPW_perkT[, match(rownames(output), colnames(NH3_TO_NO3_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$NH3))
output$`NH4(NH3)` <- apply(NH3_TO_NH4_POPW_perkT[, match(rownames(output), colnames(NH3_TO_NH4_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$NH3))
output$`BC(BC)` <- apply(BC_TO_BC_POPW_perkT[, match(rownames(output), colnames(BC_TO_BC_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$BC))
output$`POM(POM)` <- apply(POM_TO_POM_POPW_perkT[, match(rownames(output), colnames(POM_TO_POM_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$POM))
output$`other PrPM2.5(prPM)` <- apply(PRPM25_TO_PRPM25_POPW_perkT[, match(rownames(output), colnames(PRPM25_TO_PRPM25_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$PM2.5))
output$`TOTAL ANTHR dPM DRY` <- output$`SO4(SO2)` + output$`NO3(SO2)` + output$`NH4(SO2)` +
output$`SO4(NOx)` + output$`NO3(NOx)` + output$`NH4(NOx)` + output$`SO4(NH3)` + output$`NO3(NH3)` +
output$`NH4(NH3)` + output$`BC(BC)` + output$`POM(POM)` + output$`other PrPM2.5(prPM)`
output$`dPM+PM_AR5 DRY ANTHR` <- pmax(AR5_CONC$SO4_POP[match(rownames(output), rownames(AR5_CONC))] + output$`SO4(SO2)` + output$`SO4(NOx)` + output$`SO4(NH3)`, 0) +
pmax(AR5_CONC$NO3_POP[match(rownames(output), rownames(AR5_CONC))] + output$`NO3(SO2)` + output$`NO3(NOx)` + output$`NO3(NH3)`, 0) +
pmax(AR5_CONC$NH4_POP[match(rownames(output), rownames(AR5_CONC))] + output$`NH4(SO2)` + output$`NH4(NOx)` + output$`NH4(NH3)`, 0) +
pmax(AR5_CONC$BC_POP[match(rownames(output), rownames(AR5_CONC))] + output$`BC(BC)`, 0) +
pmax(AR5_CONC$POM_POP[match(rownames(output), rownames(AR5_CONC))] + output$`POM(POM)`, 0) +
output$`other PrPM2.5(prPM)`
output$`residual H2O(35%) ANTHR` <- (pmax(AR5_CONC$SO4_POP[match(rownames(output), rownames(AR5_CONC))] + output$`SO4(SO2)` + output$`SO4(NOx)` + output$`SO4(NH3)`, 0) +
pmax(AR5_CONC$NO3_POP[match(rownames(output), rownames(AR5_CONC))] + output$`NO3(SO2)` + output$`NO3(NOx)` + output$`NO3(NH3)`, 0) +
pmax(AR5_CONC$NH4_POP[match(rownames(output), rownames(AR5_CONC))] + output$`NH4(SO2)` + output$`NH4(NOx)` + output$`NH4(NH3)`, 0)) * 0.27
output$`residual H2O(50%) ANTHR` <- (pmax(AR5_CONC$SO4_POP[match(rownames(output), rownames(AR5_CONC))] + output$`SO4(SO2)` + output$`SO4(NOx)` + output$`SO4(NH3)`, 0) +
pmax(AR5_CONC$NO3_POP[match(rownames(output), rownames(AR5_CONC))] + output$`NO3(SO2)` + output$`NO3(NOx)` + output$`NO3(NH3)`, 0) +
pmax(AR5_CONC$NH4_POP[match(rownames(output), rownames(AR5_CONC))] + output$`NH4(SO2)` + output$`NH4(NOx)` + output$`NH4(NH3)`, 0)) * 0.43
output$PM_NAT <- AR5_CONC$DUST_POP[match(rownames(output), rownames(AR5_CONC))] + AR5_CONC$SS_POP[match(rownames(output), rownames(AR5_CONC))]
output$`residual H2O(35%) SS` <- AR5_CONC$SS_POP[match(rownames(output), rownames(AR5_CONC))] * 0.15
output$`residual H2O(50%) SS` <- AR5_CONC$SS_POP[match(rownames(output), rownames(AR5_CONC))] * 0.27
output$`SDMA8(NOx)` <- apply(NOx_TO_SDMA8_POPW_perkT[, match(rownames(output), colnames(NOx_TO_SDMA8_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$nox))
output$`SDMA8(NMVOC)` <- apply(NMVOC_TO_SDMA8_POPW_perkT[, match(rownames(output), colnames(NMVOC_TO_SDMA8_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$nmvoc))
output$`SDMA8(SO2)` <- apply(SO2_TO_SDMA8_POPW_perkT[, match(rownames(output), colnames(SO2_TO_SDMA8_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$so2))
output$`SDMA8(CH4)` <- apply(CH4_TO_SDMA8_POPW_perkT[, match(rownames(output), colnames(CH4_TO_SDMA8_POPW_perkT))], 2, function(x) sum(x * delta_EM_AR5$ch4))
output$`TOTAL dSDMA8 (ppb)` <- output$`SDMA8(NOx)` + output$`SDMA8(NMVOC)` + output$`SDMA8(SO2)` + output$`SDMA8(CH4)`
output$`dSDMA8 + SDMA8_AR5` <- output$`TOTAL dSDMA8 (ppb)` + AR5_CONC$SDMA8[match(rownames(output), rownames(AR5_CONC))]
View(output)
setwd("~/Documents/PSU/2020 Spring/Research/TM5_SRMs/")
library(readxl)
library(dplyr)
receptor <- "NDE"
receptor_only <- function(SRM, receptor) {
for(j in 1 : ncol(SRM)) {
if(colnames(SRM)[j] != receptor) SRM[j] <- 0
}
return(SRM)
}
AR5_EM <-read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 7) %>% tibble::column_to_rownames("SOURCE REGION")
AR5_CONC <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 8) %>% tibble::column_to_rownames("RECEPTOR REGION")
CH4_TO_SDMA8_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 9) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
NOx_TO_SDMA8_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 10) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
NMVOC_TO_SDMA8_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 11) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
SO2_TO_SDMA8_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 12) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
NH3_TO_NO3_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 13) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
NH3_TO_NH4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 14) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
NH3_TO_SO4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 15) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
NOx_TO_NH4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 16) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
NOx_TO_NO3_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 17) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
NOx_TO_SO4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 18) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
SO2_TO_SO4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 19) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
SO2_TO_NH4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 20) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
SO2_TO_NO3_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 21) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
PRPM25_TO_PRPM25_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 22) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
BC_TO_BC_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 23) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
POM_TO_POM_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 24) %>% tibble::column_to_rownames("COUNTRY") %>% receptor_only(receptor)
# This is a tentative input - it should be changed to output from GCAM
input <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 4) %>% tibble::column_to_rownames("kTonne/year")
colnames(input) <- toupper(colnames(input))
# Calculate delta for each emission
delta_EM_AR5 <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 5) %>% tibble::column_to_rownames("SOURCE REGION")
delta_EM_AR5 <- input[match(rownames(delta_EM_AR5), rownames(input)), ] - AR5_EM[match(rownames(delta_EM_AR5), rownames(AR5_EM)), ]
delta_EM_AR5$PM2.5 <- delta_EM_AR5$PM2.5 - delta_EM_AR5$BC - delta_EM_AR5$POM
View(output)
View(input)
iris %>% select(Sepal.Length)
iris %>% select("Sepal.Length")
CH4_TO_SDMA8_POPW_perkT %>% select("NDE")
setwd("~/Documents/PSU/2020 Spring/Research/TM5_SRMs/")
library(readxl)
library(dplyr)
receptor <- "NDE"
AR5_EM <-read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 7) %>% tibble::column_to_rownames("SOURCE REGION")
AR5_CONC <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 8) %>% tibble::column_to_rownames("RECEPTOR REGION")
CH4_TO_SDMA8_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 9) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
NOx_TO_SDMA8_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 10) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
NMVOC_TO_SDMA8_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 11) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
SO2_TO_SDMA8_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 12) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
NH3_TO_NO3_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 13) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
NH3_TO_NH4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 14) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
NH3_TO_SO4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 15) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
NOx_TO_NH4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 16) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
NOx_TO_NO3_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 17) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
NOx_TO_SO4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 18) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
SO2_TO_SO4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 19) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
SO2_TO_NH4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 20) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
SO2_TO_NO3_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 21) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
PRPM25_TO_PRPM25_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 22) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
BC_TO_BC_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 23) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
POM_TO_POM_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 24) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
View(POM_TO_POM_POPW_perkT_local)
View(POM_TO_POM_POPW_perkT_receptor)
# This is a tentative input - it should be changed to output from GCAM
input <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 4) %>% tibble::column_to_rownames("kTonne/year")
colnames(input) <- toupper(colnames(input))
# Calculate delta for each emission
delta_EM_AR5 <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 5) %>% tibble::column_to_rownames("SOURCE REGION")
delta_EM_AR5 <- input[match(rownames(delta_EM_AR5), rownames(input)), ] - AR5_EM[match(rownames(delta_EM_AR5), rownames(AR5_EM)), ]
delta_EM_AR5$PM2.5 <- delta_EM_AR5$PM2.5 - delta_EM_AR5$BC - delta_EM_AR5$POM
View(output)
SO2_TO_SO4_POPW_perkT_receptor["AUT", ]
SO2_TO_SO4_POPW_perkT_receptor
SO2_TO_SO4_POPW_perkT_receptor["CHN", ]
SO2_TO_SO4_POPW_perkT_receptor["CHN", "NDE"]
SO2_TO_SO4_POPW_perkT_receptor[rownames(output), ]
SO2_TO_SO4_POPW_perkT_receptor
data.frame(row.names = c("a", "b", "c"), col.names = c("d", "e"))
output <- as.data.frame(matrix(nrow = nrow(input), ncol = ncol(output)))
View(output)
output_colnames <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 2, skip = 3)
output <- as.data.frame(matrix(nrow = nrow(input), ncol = ncol(output)))
output_colnames <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 2, skip = 3)
output <- as.data.frame(matrix(nrow = nrow(input), ncol = ncol(output_colnames)))
View(output)
colnames(output) <- colnames(output_colnames)[-1]
View(output)
output_colnames <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 2, skip = 3)
output <- as.data.frame(matrix(nrow = nrow(input), ncol = ncol(output_colnames)))
rownames(output) <- rownames(input)
colnames(output) <- colnames(output_colnames)[-1]
rownames(input)
rownames(delta_EM_AR5)
# Calculate delta for each emission
delta_EM_AR5 <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 5) %>% tibble::column_to_rownames("SOURCE REGION")
delta_EM_AR5 <- input[match(rownames(delta_EM_AR5), rownames(input)), ] - AR5_EM[match(rownames(delta_EM_AR5), rownames(AR5_EM)), ]
delta_EM_AR5$PM2.5 <- delta_EM_AR5$PM2.5 - delta_EM_AR5$BC - delta_EM_AR5$POM
output_colnames <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 2, skip = 3)
output <- as.data.frame(matrix(nrow = nrow(delta_EM_AR5), ncol = ncol(output_colnames)))
rownames(output) <- rownames(delta_EM_AR5)
colnames(output) <- colnames(output_colnames)[-1]
rownames(output)
SO2_TO_SO4_POPW_perkT_receptor * delta_EM_AR5$SO2
SO2_TO_SO4_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$SO2
rownames(delta_EM_AR5)
SO2_TO_SO4_POPW_perkT_receptor
AR5_EM <-read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 7) %>% tibble::column_to_rownames("SOURCE REGION")
AR5_CONC <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 8) %>% tibble::column_to_rownames("RECEPTOR REGION")
CH4_TO_SDMA8_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 9) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
NOx_TO_SDMA8_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 10) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
NMVOC_TO_SDMA8_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 11) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
SO2_TO_SDMA8_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 12) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
NH3_TO_NO3_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 13) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
NH3_TO_NH4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 14) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
NH3_TO_SO4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 15) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
NOx_TO_NH4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 16) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
NOx_TO_NO3_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 17) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
NOx_TO_SO4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 18) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
SO2_TO_SO4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 19) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
SO2_TO_NH4_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 20) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
SO2_TO_NO3_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 21) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
PRPM25_TO_PRPM25_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 22) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
BC_TO_BC_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 23) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
POM_TO_POM_POPW_perkT_receptor <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 24) %>% tibble::column_to_rownames("COUNTRY") %>% select(receptor)
# Calculate delta for each emission
delta_EM_AR5 <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 5) %>% tibble::column_to_rownames("SOURCE REGION")
# This is a tentative input - it should be changed to output from GCAM
input <- read_xlsx(path = "NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 4) %>% tibble::column_to_rownames("kTonne/year")
colnames(input) <- toupper(colnames(input))
# Calculate delta for each emission
delta_EM_AR5 <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 5) %>% tibble::column_to_rownames("SOURCE REGION")
delta_EM_AR5 <- input[match(rownames(delta_EM_AR5), rownames(input)), ] - AR5_EM[match(rownames(delta_EM_AR5), rownames(AR5_EM)), ]
delta_EM_AR5$PM2.5 <- delta_EM_AR5$PM2.5 - delta_EM_AR5$BC - delta_EM_AR5$POM
output_colnames <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 2, skip = 3)
output <- as.data.frame(matrix(nrow = nrow(delta_EM_AR5), ncol = ncol(output_colnames)))
rownames(output) <- rownames(delta_EM_AR5)
colnames(output) <- colnames(output_colnames)[-1]
SO2_TO_SO4_POPW_perkT_receptor[rownames(delta_EM_AR5), ]
SO2_TO_SO4_POPW_perkT_receptor
SO2_TO_SO4_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$SO2
output$`SO4(SO2)` <- SO2_TO_SO4_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$SO2
View(output)
output$`NO3(SO2)` <- SO2_TO_NO3_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$SO2
output$`NH4(SO2)` <- SO2_TO_NH4_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$SO2
output$`SO4(NOx)` <- NOx_TO_SO4_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$NOx
output$`NO3(NOx)` <- NOx_TO_NO3_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$NOx
output$`NH4(NOx)` <- NOx_TO_NH4_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$NOx
output$`SO4(SO2)` <- SO2_TO_SO4_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$SO2
output$`NO3(SO2)` <- SO2_TO_NO3_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$SO2
output$`NH4(SO2)` <- SO2_TO_NH4_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$SO2
output$`SO4(NOx)` <- NOx_TO_SO4_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$NOx
NOx_TO_SO4_POPW_perkT_receptor
NOx_TO_SO4_POPW_perkT_receptor[rownames(delta_EM_AR5), ]
output$`SO4(NOx)` <- NOx_TO_SO4_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$NOX
output$`NO3(NOx)` <- NOx_TO_NO3_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$NOX
output$`NH4(NOx)` <- NOx_TO_NH4_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$NOX
output$`SO4(NH3)` <- NH3_TO_SO4_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$NH3
output$`NO3(NH3)` <- NH3_TO_NO3_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$NH3
output$`NH4(NH3)` <- NH3_TO_NH4_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$NH3
View(output)
output$`BC(BC)` <- BC_TO_BC_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$BC
output$`POM(POM)` <- POM_TO_POM_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$POM
output$`other PrPM2.5(prPM)` <- PRPM25_TO_PRPM25_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$PM2.5
output$`TOTAL ANTHR dPM DRY` <- output$`SO4(SO2)` + output$`NO3(SO2)` + output$`NH4(SO2)` +
output$`SO4(NOx)` + output$`NO3(NOx)` + output$`NH4(NOx)` + output$`SO4(NH3)` + output$`NO3(NH3)` +
output$`NH4(NH3)` + output$`BC(BC)` + output$`POM(POM)` + output$`other PrPM2.5(prPM)`
output$`dPM+PM_AR5 DRY ANTHR` <- pmax(AR5_CONC$SO4_POP[match(rownames(output), rownames(AR5_CONC))] + output$`SO4(SO2)` + output$`SO4(NOx)` + output$`SO4(NH3)`, 0) +
pmax(AR5_CONC$NO3_POP[match(rownames(output), rownames(AR5_CONC))] + output$`NO3(SO2)` + output$`NO3(NOx)` + output$`NO3(NH3)`, 0) +
pmax(AR5_CONC$NH4_POP[match(rownames(output), rownames(AR5_CONC))] + output$`NH4(SO2)` + output$`NH4(NOx)` + output$`NH4(NH3)`, 0) +
pmax(AR5_CONC$BC_POP[match(rownames(output), rownames(AR5_CONC))] + output$`BC(BC)`, 0) +
pmax(AR5_CONC$POM_POP[match(rownames(output), rownames(AR5_CONC))] + output$`POM(POM)`, 0) +
output$`other PrPM2.5(prPM)`
output$`residual H2O(35%) ANTHR` <- (pmax(AR5_CONC$SO4_POP[match(rownames(output), rownames(AR5_CONC))] + output$`SO4(SO2)` + output$`SO4(NOx)` + output$`SO4(NH3)`, 0) +
pmax(AR5_CONC$NO3_POP[match(rownames(output), rownames(AR5_CONC))] + output$`NO3(SO2)` + output$`NO3(NOx)` + output$`NO3(NH3)`, 0) +
pmax(AR5_CONC$NH4_POP[match(rownames(output), rownames(AR5_CONC))] + output$`NH4(SO2)` + output$`NH4(NOx)` + output$`NH4(NH3)`, 0)) * 0.27
output$`residual H2O(50%) ANTHR` <- (pmax(AR5_CONC$SO4_POP[match(rownames(output), rownames(AR5_CONC))] + output$`SO4(SO2)` + output$`SO4(NOx)` + output$`SO4(NH3)`, 0) +
pmax(AR5_CONC$NO3_POP[match(rownames(output), rownames(AR5_CONC))] + output$`NO3(SO2)` + output$`NO3(NOx)` + output$`NO3(NH3)`, 0) +
pmax(AR5_CONC$NH4_POP[match(rownames(output), rownames(AR5_CONC))] + output$`NH4(SO2)` + output$`NH4(NOx)` + output$`NH4(NH3)`, 0)) * 0.43
output$PM_NAT <- AR5_CONC$DUST_POP[match(rownames(output), rownames(AR5_CONC))] + AR5_CONC$SS_POP[match(rownames(output), rownames(AR5_CONC))]
output$`residual H2O(35%) SS` <- AR5_CONC$SS_POP[match(rownames(output), rownames(AR5_CONC))] * 0.15
output$`residual H2O(50%) SS` <- AR5_CONC$SS_POP[match(rownames(output), rownames(AR5_CONC))] * 0.27
output$`SDMA8(NOx)` <- apply(NOx_TO_SDMA8_POPW_perkT_receptor[, match(rownames(output), colnames(NOx_TO_SDMA8_POPW_perkT_receptor))], 2, function(x) sum(x * delta_EM_AR5$nox))
output$`SDMA8(NOx)` <- NOx_TO_SDM8_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$NOX
output$`SDMA8(NOx)` <- NOx_TO_SDMA8_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$NOX
output$`SDMA8(NMVOC)` <- NMVOC_TO_SDMA8_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$NMVOC
output$`SDMA8(SO2)` <- SO2_TO_SDMA8_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$SO2
output$`SDMA8(CH4)` <- CH4_TO_SDMA8_POPW_perkT_receptor[rownames(delta_EM_AR5), ] * delta_EM_AR5$CH4
output$`TOTAL dSDMA8 (ppb)` <- output$`SDMA8(NOx)` + output$`SDMA8(NMVOC)` + output$`SDMA8(SO2)` + output$`SDMA8(CH4)`
output$`dSDMA8 + SDMA8_AR5` <- output$`TOTAL dSDMA8 (ppb)` + AR5_CONC$SDMA8[match(rownames(output), rownames(AR5_CONC))]
View(output)
colnames(input) <- toupper(colnames(input))
# Calculate delta for each emission
delta_EM_AR5 <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 5) %>% tibble::column_to_rownames("SOURCE REGION")
delta_EM_AR5 <- input[match(rownames(delta_EM_AR5), rownames(input)), ] - AR5_EM[match(rownames(delta_EM_AR5), rownames(AR5_EM)), ]
delta_EM_AR5$PM2.5 <- delta_EM_AR5$PM2.5 - delta_EM_AR5$BC - delta_EM_AR5$POM
output_colnames <- read_xlsx(path = "~/Documents/PSU/2020 Spring/Research/TM5_SRMs/NORMALIZED_SR_PM_O3_POPW.xlsx", sheet = 2, skip = 3)
output <- as.data.frame(matrix(nrow = nrow(delta_EM_AR5), ncol = ncol(output_colnames)))
rownames(output) <- rownames(delta_EM_AR5)
colnames(output) <- colnames(output_colnames)[-1]
View(output)
iris %>% select(-Petal.Length, -Petal.Width)
output <- output %>% select(-`dPM+PM_AR5 DRY ANTHR`, -`residual H2O(35%) ANTHR`, -`residual H2O(50%) ANTHR`,
-PM_NAT, -`residual H2O(35%) SS`, -`residual H2O(50%) SS`)
View(output)
output <- output %>% select(-`dPM+PM_AR5 DRY ANTHR`)
output <- output %>% select(-"dPM+PM_AR5 DRY ANTHR")
iris %>% select(-`Species`)
